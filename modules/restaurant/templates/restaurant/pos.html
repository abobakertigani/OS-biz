<!-- modules/restaurant/templates/restaurant/pos.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ù‚Ø·Ø© Ø¨ÙŠØ¹ - Ù…Ø·Ø¹Ù…</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .table { display: inline-block; width: 100px; height: 100px; margin: 10px; text-align: center; line-height: 100px; border: 2px solid #007bff; border-radius: 10px; cursor: pointer; }
        .occupied { background-color: #f8d7da; border-color: #dc3545; }
        .free { background-color: #d1e7dd; border-color: #198754; }
        .menu { list-style: none; padding: 0; }
        .menu li { padding: 8px; margin: 5px 0; background: #f0f0f0; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø·Ø© Ø¨ÙŠØ¹ Ø§Ù„Ù…Ø·Ø¹Ù…</h1>

    <h2>Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª</h2>
    <div id="tables">
        <p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª...</p>
    </div>

    <h2>Ø§Ù„Ù…Ù†ÙŠÙˆ</h2>
    <ul id="menu" class="menu"></ul>

    <h2>Ø§Ù„Ø³Ù„Ø©</h2>
    <ul id="cart"></ul>
    <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: </strong><span id="total">0</span> Ø±.Ø³</p>
    <button onclick="submitOrder()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
	<a href="/restaurant/ingredients">ğŸ”§ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØµÙØ§Øª</a>
   
    <script>
        let cart = [];
        const totalSpan = document.getElementById('total');

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª
        fetch('/restaurant/tables')
            .then(r => r.text())
            .then(html => {
                const temp = document.createElement('div');
                temp.innerHTML = html;
                document.getElementById('tables').innerHTML = temp.querySelector('#tables').innerHTML;
            });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ÙŠÙˆ
        fetch('/restaurant/menu')
            .then(r => r.json())
            .then(items => {
                const menu = document.getElementById('menu');
                menu.innerHTML = '';
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.name} - ${item.price} Ø±.Ø³`;
                    li.onclick = () => addToCart(item);
                    menu.appendChild(li);
                });
            });

function addToCart(item) {
    const quantity = prompt(`ÙƒÙ… Ø¹Ø¯Ø¯ ${item.name}ØŸ`, "1");
    const qty = parseInt(quantity) || 1;

    for (let i = 0; i < qty; i++) {
        cart.push(item);
    }
    renderCart();
}

        function renderCart() {
            const cartEl = document.getElementById('cart');
            cartEl.innerHTML = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price;
                const li = document.createElement('li');
                li.textContent = item.name;
                cartEl.appendChild(li);
            });
            totalSpan.textContent = total.toFixed(2);
        }

        function submitOrder() {
    const tableId = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:");
    if (!tableId) return;

    // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ø¹ Ø§Ù„ÙƒÙ…ÙŠØ©
    const itemsWithQty = [];
    cart.forEach(item => {
        const existing = itemsWithQty.find(i => i.id === item.id);
        if (existing) {
            existing.quantity += 1;
        } else {
            itemsWithQty.push({ ...item, quantity: 1 });
        }
    });

    fetch('/restaurant/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `table_id=${tableId}&items=${encodeURIComponent(JSON.stringify(itemsWithQty))}&total=${totalSpan.textContent}`
    }).then(() => {
        alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!');
        cart = [];
        renderCart();
    });
}
    </script>
</body>
</html> 
